"""
EJERCICIO 1.1: GESTI√ìN DE MATERIALES BIBLIOGR√ÅFICOS
"""

from datetime import datetime

class MaterialBibliografico:
    def __init__(self, titulo, autor, a√±o_publicacion, codigo_unico):
        self.__titulo = titulo
        self.__autor = autor
        self.__a√±o_publicacion = a√±o_publicacion
        self.__codigo_unico = codigo_unico
    
    def get_titulo(self):
        return self.__titulo
    
    def set_titulo(self, titulo):
        if not titulo or not isinstance(titulo, str):
            raise ValueError("T√≠tulo inv√°lido")
        self.__titulo = titulo
    
    def get_autor(self):
        return self.__autor
    
    def set_autor(self, autor):
        if not autor or not isinstance(autor, str):
            raise ValueError("Autor inv√°lido")
        self.__autor = autor
    
    def get_a√±o_publicacion(self):
        return self.__a√±o_publicacion
    
    def set_a√±o_publicacion(self, a√±o):
        if not isinstance(a√±o, int) or a√±o < 0 or a√±o > datetime.now().year:
            raise ValueError("A√±o de publicaci√≥n inv√°lido")
        self.__a√±o_publicacion = a√±o
    
    def get_codigo_unico(self):
        return self.__codigo_unico
    
    def set_codigo_unico(self, codigo):
        if not codigo or not isinstance(codigo, str):
            raise ValueError("C√≥digo √∫nico inv√°lido")
        self.__codigo_unico = codigo
    
    def calcular_valor_prestamo(self, dias):
        raise NotImplementedError("Este m√©todo debe ser implementado")
    
    def obtener_tipo_material(self):
        raise NotImplementedError("Este m√©todo debe ser implementado")
    
    def __str__(self):
        return f"{self.obtener_tipo_material()}: {self.__titulo} - {self.__autor} ({self.__a√±o_publicacion})"

class LibroFisico(MaterialBibliografico):
    def __init__(self, titulo, autor, a√±o_publicacion, codigo_unico, num_paginas, editorial, estado_fisico):
        super().__init__(titulo, autor, a√±o_publicacion, codigo_unico)
        self.__num_paginas = num_paginas
        self.__editorial = editorial
        self.__estado_fisico = estado_fisico
    
    def calcular_valor_prestamo(self, dias):
        return 2.00 * dias
    
    def obtener_tipo_material(self):
        return "Libro F√≠sico"
    
    def get_num_paginas(self):
        return self.__num_paginas
    
    def set_num_paginas(self, paginas):
        if not isinstance(paginas, int) or paginas <= 0:
            raise ValueError("N√∫mero de p√°ginas inv√°lido")
        self.__num_paginas = paginas
    
    def get_editorial(self):
        return self.__editorial
    
    def set_editorial(self, editorial):
        if not editorial or not isinstance(editorial, str):
            raise ValueError("Editorial inv√°lida")
        self.__editorial = editorial
    
    def get_estado_fisico(self):
        return self.__estado_fisico
    
    def set_estado_fisico(self, estado):
        estados_validos = ["excelente", "bueno", "regular", "malo"]
        if estado not in estados_validos:
            raise ValueError("Estado f√≠sico inv√°lido")
        self.__estado_fisico = estado
    
    def __str__(self):
        return f"{super().__str__()} | P√°ginas: {self.__num_paginas} | Editorial: {self.__editorial}"

class LibroElectronico(MaterialBibliografico):
    def __init__(self, titulo, autor, a√±o_publicacion, codigo_unico, tama√±o_mb, formato, url_descarga):
        super().__init__(titulo, autor, a√±o_publicacion, codigo_unico)
        self.__tama√±o_mb = tama√±o_mb
        self.__formato = formato
        self.__url_descarga = url_descarga
    
    def calcular_valor_prestamo(self, dias):
        return 1.00 * dias
    
    def obtener_tipo_material(self):
        return "Libro Electr√≥nico"
    
    def get_tama√±o_mb(self):
        return self.__tama√±o_mb
    
    def set_tama√±o_mb(self, tama√±o):
        if not isinstance(tama√±o, (int, float)) or tama√±o <= 0:
            raise ValueError("Tama√±o inv√°lido")
        self.__tama√±o_mb = tama√±o
    
    def get_formato(self):
        return self.__formato
    
    def set_formato(self, formato):
        formatos_validos = ["PDF", "EPUB", "MOBI", "AZW"]
        if formato not in formatos_validos:
            raise ValueError("Formato inv√°lido")
        self.__formato = formato
    
    def get_url_descarga(self):
        return self.__url_descarga
    
    def set_url_descarga(self, url):
        if not url or "http" not in url:
            raise ValueError("URL inv√°lida")
        self.__url_descarga = url
    
    def __str__(self):
        return f"{super().__str__()} | Formato: {self.__formato} | Tama√±o: {self.__tama√±o_mb}MB"

class Revista(MaterialBibliografico):
    def __init__(self, titulo, autor, a√±o_publicacion, codigo_unico, numero_edicion, mes_publicacion):
        super().__init__(titulo, autor, a√±o_publicacion, codigo_unico)
        self.__numero_edicion = numero_edicion
        self.__mes_publicacion = mes_publicacion
    
    def calcular_valor_prestamo(self, dias):
        return 0.50 * dias
    
    def obtener_tipo_material(self):
        return "Revista"
    
    def get_numero_edicion(self):
        return self.__numero_edicion
    
    def set_numero_edicion(self, numero):
        if not isinstance(numero, int) or numero <= 0:
            raise ValueError("N√∫mero de edici√≥n inv√°lido")
        self.__numero_edicion = numero
    
    def get_mes_publicacion(self):
        return self.__mes_publicacion
    
    def set_mes_publicacion(self, mes):
        meses_validos = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                        "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]
        if mes not in meses_validos:
            raise ValueError("Mes inv√°lido")
        self.__mes_publicacion = mes
    
    def __str__(self):
        return f"{super().__str__()} | Edici√≥n: {self.__numero_edicion} | Mes: {self.__mes_publicacion}"

class Audiolibro(MaterialBibliografico):
    def __init__(self, titulo, autor, a√±o_publicacion, codigo_unico, duracion_minutos, narrador, formato_audio):
        super().__init__(titulo, autor, a√±o_publicacion, codigo_unico)
        self.__duracion_minutos = duracion_minutos
        self.__narrador = narrador
        self.__formato_audio = formato_audio
    
    def calcular_valor_prestamo(self, dias):
        return 1.50 * dias
    
    def obtener_tipo_material(self):
        return "Audiolibro"
    
    def get_duracion_minutos(self):
        return self.__duracion_minutos
    
    def set_duracion_minutos(self, duracion):
        if not isinstance(duracion, (int, float)) or duracion <= 0:
            raise ValueError("Duraci√≥n inv√°lida")
        self.__duracion_minutos = duracion
    
    def get_narrador(self):
        return self.__narrador
    
    def set_narrador(self, narrador):
        if not narrador or not isinstance(narrador, str):
            raise ValueError("Narrador inv√°lido")
        self.__narrador = narrador
    
    def get_formato_audio(self):
        return self.__formato_audio
    
    def set_formato_audio(self, formato):
        formatos_validos = ["MP3", "WAV", "AAC", "FLAC"]
        if formato not in formatos_validos:
            raise ValueError("Formato de audio inv√°lido")
        self.__formato_audio = formato
    
    def __str__(self):
        return f"{super().__str__()} | Duraci√≥n: {self.__duracion_minutos}min | Narrador: {self.__narrador}"

# ========== MEN√ö INTERACTIVO ==========
class MenuMateriales:
    def __init__(self):
        self.materiales = []
        self.cargar_datos_ejemplo()
    
    def cargar_datos_ejemplo(self):
        """Carga datos de ejemplo para probar"""
        self.materiales.append(
            LibroFisico("Cien A√±os de Soledad", "Gabriel Garc√≠a M√°rquez", 
                        1967, "LIB001", 471, "Sudamericana", "bueno")
        )
        self.materiales.append(
            LibroElectronico("Python Crash Course", "Eric Matthes", 
                             2015, "ELE001", 5.2, "PDF", "https://descarga.com/python.pdf")
        )
        self.materiales.append(
            Revista("National Geographic", "Varios Autores", 
                    2023, "REV001", 245, "Octubre")
        )
        self.materiales.append(
            Audiolibro("El Principito", "Antoine de Saint-Exup√©ry", 
                       1943, "AUD001", 120, "Luis Piedrahita", "MP3")
        )
    
    def mostrar_menu_principal(self):
        print("\n" + "="*60)
        print("üìö SISTEMA DE GESTI√ìN DE MATERIALES BIBLIOGR√ÅFICOS")
        print("="*60)
        print("1. üìñ Crear nuevo material")
        print("2. üëÄ Ver todos los materiales")
        print("3. üîç Buscar material por c√≥digo")
        print("4. üí∞ Calcular costo de pr√©stamo")
        print("5. üéØ Demostrar polimorfismo")
        print("6. üîí Demostrar encapsulamiento")
        print("7. üìä Estad√≠sticas")
        print("0. üö™ Salir")
        print("-"*60)
    
    def mostrar_menu_creacion(self):
        print("\n" + "="*40)
        print("üìù CREAR NUEVO MATERIAL")
        print("="*40)
        print("1. Libro F√≠sico")
        print("2. Libro Electr√≥nico")
        print("3. Revista")
        print("4. Audiolibro")
        print("0. Volver")
        print("-"*40)
    
    def obtener_entrada(self, mensaje, tipo=str):
        while True:
            try:
                entrada = input(f"{mensaje}: ").strip()
                if tipo == int:
                    return int(entrada)
                elif tipo == float:
                    return float(entrada)
                return entrada
            except ValueError:
                print("‚ùå Entrada inv√°lida. Intente nuevamente.")
    
    def crear_libro_fisico(self):
        print("\n--- CREAR LIBRO F√çSICO ---")
        titulo = self.obtener_entrada("T√≠tulo")
        autor = self.obtener_entrada("Autor")
        a√±o = self.obtener_entrada("A√±o publicaci√≥n", int)
        codigo = self.obtener_entrada("C√≥digo √∫nico")
        paginas = self.obtener_entrada("N√∫mero de p√°ginas", int)
        editorial = self.obtener_entrada("Editorial")
        estado = self.obtener_entrada("Estado (excelente/bueno/regular/malo)")
        
        try:
            libro = LibroFisico(titulo, autor, a√±o, codigo, paginas, editorial, estado)
            self.materiales.append(libro)
            print(f"‚úÖ Libro f√≠sico '{titulo}' creado exitosamente!")
        except ValueError as e:
            print(f"‚ùå Error: {e}")
    
    def crear_libro_electronico(self):
        print("\n--- CREAR LIBRO ELECTR√ìNICO ---")
        titulo = self.obtener_entrada("T√≠tulo")
        autor = self.obtener_entrada("Autor")
        a√±o = self.obtener_entrada("A√±o publicaci√≥n", int)
        codigo = self.obtener_entrada("C√≥digo √∫nico")
        tama√±o = self.obtener_entrada("Tama√±o en MB", float)
        formato = self.obtener_entrada("Formato (PDF/EPUB/MOBI/AZW)")
        url = self.obtener_entrada("URL de descarga")
        
        try:
            libro = LibroElectronico(titulo, autor, a√±o, codigo, tama√±o, formato, url)
            self.materiales.append(libro)
            print(f"‚úÖ Libro electr√≥nico '{titulo}' creado exitosamente!")
        except ValueError as e:
            print(f"‚ùå Error: {e}")
    
    def crear_revista(self):
        print("\n--- CREAR REVISTA ---")
        titulo = self.obtener_entrada("T√≠tulo")
        autor = self.obtener_entrada("Autor")
        a√±o = self.obtener_entrada("A√±o publicaci√≥n", int)
        codigo = self.obtener_entrada("C√≥digo √∫nico")
        edicion = self.obtener_entrada("N√∫mero de edici√≥n", int)
        mes = self.obtener_entrada("Mes de publicaci√≥n")
        
        try:
            revista = Revista(titulo, autor, a√±o, codigo, edicion, mes)
            self.materiales.append(revista)
            print(f"‚úÖ Revista '{titulo}' creada exitosamente!")
        except ValueError as e:
            print(f"‚ùå Error: {e}")
    
    def crear_audiolibro(self):
        print("\n--- CREAR AUDIOLIBRO ---")
        titulo = self.obtener_entrada("T√≠tulo")
        autor = self.obtener_entrada("Autor")
        a√±o = self.obtener_entrada("A√±o publicaci√≥n", int)
        codigo = self.obtener_entrada("C√≥digo √∫nico")
        duracion = self.obtener_entrada("Duraci√≥n en minutos", float)
        narrador = self.obtener_entrada("Narrador")
        formato = self.obtener_entrada("Formato (MP3/WAV/AAC/FLAC)")
        
        try:
            audio = Audiolibro(titulo, autor, a√±o, codigo, duracion, narrador, formato)
            self.materiales.append(audio)
            print(f"‚úÖ Audiolibro '{titulo}' creado exitosamente!")
        except ValueError as e:
            print(f"‚ùå Error: {e}")
    
    def ver_materiales(self):
        if not self.materiales:
            print("\nüì≠ No hay materiales registrados.")
            return
        
        print("\n" + "="*80)
        print("üìö LISTA DE MATERIALES BIBLIOGR√ÅFICOS")
        print("="*80)
        for i, material in enumerate(self.materiales, 1):
            print(f"{i}. {material}")
        print("-"*80)
        print(f"Total: {len(self.materiales)} materiales")
    
    def buscar_por_codigo(self):
        codigo = self.obtener_entrada("\nüîç Ingrese c√≥digo √∫nico a buscar")
        
        for material in self.materiales:
            if material.get_codigo_unico() == codigo:
                print("\n‚úÖ MATERIAL ENCONTRADO:")
                print(material)
                return
        
        print(f"‚ùå No se encontr√≥ material con c√≥digo: {codigo}")
    
    def calcular_costo_prestamo(self):
        if not self.materiales:
            print("\nüì≠ No hay materiales para calcular.")
            return
        
        self.ver_materiales()
        try:
            opcion = self.obtener_entrada("\nüìÖ Ingrese n√∫mero de material", int) - 1
            if 0 <= opcion < len(self.materiales):
                dias = self.obtener_entrada("Ingrese n√∫mero de d√≠as", int)
                material = self.materiales[opcion]
                costo = material.calcular_valor_prestamo(dias)
                print(f"\nüí∞ COSTO DE PR√âSTAMO:")
                print(f"Material: {material.get_titulo()}")
                print(f"D√≠as: {dias}")
                print(f"Costo: ${costo:.2f}")
                print(f"Tipo: {material.obtener_tipo_material()}")
        except (ValueError, IndexError):
            print("‚ùå Opci√≥n inv√°lida")
    
    def demostrar_polimorfismo(self):
        if not self.materiales:
            print("\nüì≠ No hay materiales para demostrar.")
            return
        
        print("\n" + "="*60)
        print("üéØ DEMOSTRACI√ìN DE POLIMORFISMO")
        print("="*60)
        print("Mismo m√©todo calcular_valor_prestamo(), diferentes resultados:")
        print("-"*60)
        
        dias = 5
        total = 0
        
        for material in self.materiales:
            costo = material.calcular_valor_prestamo(dias)
            total += costo
            print(f"{material.obtener_tipo_material():20} ‚Üí ${costo:.2f} (${costo/dias:.2f}/d√≠a)")
        
        print("-"*60)
        print(f"Total para {dias} d√≠as: ${total:.2f}")
    
    def demostrar_encapsulamiento(self):
        print("\n" + "="*60)
        print("üîí DEMOSTRACI√ìN DE ENCAPSULAMIENTO")
        print("="*60)
        print("1. Intentando acceder a atributos privados directamente:")
        print("   material.__titulo ‚Üí Generar√° AttributeError")
        print("\n2. Usando getters y setters con validaci√≥n:")
        
        if self.materiales:
            material = self.materiales[0]
            print(f"   T√≠tulo actual: {material.get_titulo()}")
            
            # Intentar asignar valor inv√°lido
            try:
                material.set_titulo("")  # T√≠tulo vac√≠o
            except ValueError as e:
                print(f"   ‚ùå Setter bloquea t√≠tulo vac√≠o: {e}")
            
            # Asignar valor v√°lido
            try:
                material.set_titulo("Nuevo T√≠tulo V√°lido")
                print(f"   ‚úÖ Setter acepta t√≠tulo v√°lido: {material.get_titulo()}")
            except ValueError as e:
                print(f"   ‚ùå Error: {e}")
    
    def mostrar_estadisticas(self):
        if not self.materiales:
            print("\nüì≠ No hay materiales para estad√≠sticas.")
            return
        
        print("\n" + "="*60)
        print("üìä ESTAD√çSTICAS DEL SISTEMA")
        print("="*60)
        
        # Contar por tipo
        tipos = {}
        for material in self.materiales:
            tipo = material.obtener_tipo_material()
            tipos[tipo] = tipos.get(tipo, 0) + 1
        
        print("üìà Distribuci√≥n por tipo:")
        for tipo, cantidad in tipos.items():
            print(f"   {tipo}: {cantidad}")
        
        print(f"\nüì¶ Total de materiales: {len(self.materiales)}")
        
        # Calcular valor promedio de pr√©stamo por 7 d√≠as
        total_7_dias = sum(m.calcular_valor_prestamo(7) for m in self.materiales)
        print(f"üí∞ Valor total de pr√©stamos (7 d√≠as): ${total_7_dias:.2f}")
    
    def ejecutar(self):
        while True:
            self.mostrar_menu_principal()
            opcion = self.obtener_entrada("Seleccione una opci√≥n", int)
            
            if opcion == 0:
                print("\nüëã ¬°Gracias por usar el sistema!")
                break
            
            elif opcion == 1:
                while True:
                    self.mostrar_menu_creacion()
                    sub_opcion = self.obtener_entrada("Seleccione tipo de material", int)
                    
                    if sub_opcion == 0:
                        break
                    elif sub_opcion == 1:
                        self.crear_libro_fisico()
                    elif sub_opcion == 2:
                        self.crear_libro_electronico()
                    elif sub_opcion == 3:
                        self.crear_revista()
                    elif sub_opcion == 4:
                        self.crear_audiolibro()
                    else:
                        print("‚ùå Opci√≥n inv√°lida")
            
            elif opcion == 2:
                self.ver_materiales()
            
            elif opcion == 3:
                self.buscar_por_codigo()
            
            elif opcion == 4:
                self.calcular_costo_prestamo()
            
            elif opcion == 5:
                self.demostrar_polimorfismo()
            
            elif opcion == 6:
                self.demostrar_encapsulamiento()
            
            elif opcion == 7:
                self.mostrar_estadisticas()
            
            else:
                print("‚ùå Opci√≥n inv√°lida")
            
            if opcion != 0:
                input("\n‚èé Presione Enter para continuar...")

# ========== PROGRAMA PRINCIPAL ==========
if __name__ == "__main__":
    print("="*60)
    print("EJERCICIO 1.1: GESTI√ìN DE MATERIALES BIBLIOGR√ÅFICOS")
    print("="*60)
    
    # Demostrar que no se puede instanciar clase abstracta
    print("\nüîç Demostrando ABSTRACCI√ìN:")
    try:
        # Intentar crear objeto de clase abstracta
        material = MaterialBibliografico("Test", "Autor", 2023, "ABC123")
        print("‚ùå ERROR: No deber√≠a poder instanciarse")
    except NotImplementedError as e:
        print(f"‚úÖ CORRECTO: No se puede instanciar MaterialBibliografico")
        print(f"   Error: {e}")
    
    input("\n‚èé Presione Enter para iniciar el sistema interactivo...")
    
    # Iniciar men√∫ interactivo
    sistema = MenuMateriales()
    sistema.ejecutar()
